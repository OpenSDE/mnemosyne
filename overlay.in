# --- SDE-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
#
# Filename: target/mnemosyne/overlay.in
# Copyright (C) 2008 The OpenSDE Project
#
# More information can be found in the files COPYING and README.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- SDE-COPYRIGHT-NOTE-END ---

mnemosyne_overlay_dir="$base/target/$SDECFG_TRG_MNEMOSYNE/overlay.d"
mnemosyne_overlay=

mnemosyne_overlay_apply() {
	local x=
	for x; do
		overlay_apply "$x"
	done
}

hook_add postdoc 5 'eval mnemosyne_overlay_apply $mnemosyne_overlay'

# $pkg specific overlays
y="pkgs"
for x in vserver HD initrd; do
	if [ "$SDECFG_TRG_MNEMOSYNE_BOOT" = "$x" ]; then
		y="$y boot-$x"
	else
		y="$y boot-no$x"
	fi
done

for x in $y; do
	z="$mnemosyne_overlay_dir/$x/$pkg/"
	if [ -d "$z" ]; then
		var_append mnemosyne_overlay ' ' "$z"
	fi
done

# conditional $pkg specific overlays
case "$pkg" in
busybox)
	if [ "$SDECFG_TRG_MNEMOSYNE_EMBEDDED_INIT" = 1 ]; then
		var_append mnemosyne_overlay ' ' "$mnemosyne_overlay_dir/busybox-init"
	fi
	;;
sysfiles)
	if [ "$SDECFG_TRG_MNEMOSYNE_FOOTPRINT" = embedded ]; then
		var_append mnemosyne_overlay ' ' "$mnemosyne_overlay_dir/$pkg-embedded"
	fi
	;;
esac

unset mnemosyne_overlay_dir
